<!DOCTYPE html>
<html>
<head>
    <title></title>
</head>
<body>
    <button onclick="bClick(this)">B</button>
    <button onclick="bClick2(this)">B2</button>
    <button onclick="uClick(this)">U</button>
    <button>C</button>
    <div
        contenteditable
        style="width: 500px; height: 500px; background-color: lightgrey;">
        <h3><span style="color: blue;">312</span><span style="color: red;">32</span>1</h3>
        <h4>3123213</h4>
        31232
        <div>abcdefg</div>
    </div>
    <pre>
        节点编号：   节点名称：
        1   Element
        2   Attribute
        3   Text
        4   CDATA Section
        5   Entity Reference
        6   Entity
        7   Processing Instrucion
        8   Comment
        9   Document
        10  Document Type
        11  Document Fragment
        12  Notation

        ref: http://cqh520llr.iteye.com/blog/1881896
    </pre>
</body>
<script>
    // current Selection
    var select = getSelection();

    // this Editor
    var rootNode = document.querySelector('div');


    // start to make style
    var bClick = function(self){
        var range = select.getRangeAt(0);
        text = range.toString();
        var strong = document.createElement('strong');
        var editingFlag = range.cloneContents();
        debugger;
        // clearNode(editingFlag, strong)
        strong.appendChild(editingFlag);
        range.deleteContents();
        range.insertNode(strong);
    };


    //
    var uClick = function(self){
        var range = select.getRangeAt(0);
        text = range.toString();
        var em = document.createElement('em');
        var editingFlag = range.cloneContents();
        em.appendChild(editingFlag, em);
        range.deleteContents();
        range.insertNode(em);
    };


    //
    var bClick2 = function(self){
        var treeWalker = document.createTreeWalker(
          rootNode,
          NodeFilter.SHOW_TEXT
        );

        var nodeList = [];

        while(treeWalker.nextNode()) nodeList.push(treeWalker.currentNode);

        var range = select.getRangeAt(0);

        var flag = false;

        var $s = nodeList.indexOf(range.startContainer);
        var $e = nodeList.indexOf(range.endContainer);


        // 會需要 textNode 切割與轉換成 domNode
        for(var i = $s; i <= $e; i++){
            if(nodeList[i].parentNode !== rootNode){
                // if parentNode is not rootNode make parent style is ok.
                nodeList[i].parentNode.style.color = 'red';
            }
            else{
                // make textNode to fontNode
                font = document.createElement('font');
                font.style.color = 'red';
                font.textContent = nodeList[i].nodeValue;
                nodeList[i].parentNode.insertBefore(font, nodeList[i]);
                nodeList[i].remove();
                continue;
            }
        }

        // for(var i = 0; i < nodeList.length; i++){
            // if(nodeList[i] === range.startContainer){
            //     console.log(i, nodeList[i], nodeList[i].parentNode, range.startContainer, range.endContainer);
            // }
            // else if(nodeList[i] === range.endContainer){
            //     console.log(i, nodeList[i], nodeList[i].parentNode, range.startContainer, range.endContainer);
            //     break;
            // }


            // nodeList[i].nodeValue = '';              // equal parentNode.textContent = '';
        // }
        // debugger;
    }
</script>
</html>